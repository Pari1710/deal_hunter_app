<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Dashboard - AI Analyzer</title>
    <style>
        /* --- GLOBAL STYLES & NEW NEUTRAL THEME --- */
        :root {
            --bg-light: #F8F9FA; --bg-white: #FFFFFF; --border-color: #DEE2E6;
            --text-dark: #212529; --text-muted: #6C757D; --accent-blue: #0D6EFD;
            --accent-green: #198754; --accent-yellow: #FFC107; --accent-red: #DC3545;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            display: flex;
        }

        /* --- SIDEBAR NAVIGATION --- */
        .sidebar {
            width: 280px;
            background-color: var(--bg-white);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 40px;
        }
        .sidebar-header span { color: var(--accent-blue); }
        .nav-menu { list-style: none; flex-grow: 1; }
        .nav-item a {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-muted);
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-item a:hover { background-color: var(--bg-light); color: var(--text-dark); }
        .nav-item a.active { background-color: var(--accent-blue); color: #fff; }
        .nav-item a svg { margin-right: 12px; }

        /* --- MAIN CONTENT AREA --- */
        .main-content {
            margin-left: 280px;
            width: calc(100% - 280px);
            padding: 40px;
            animation: fadeIn 0.5s ease-out;
        }
        .page { display: none; }
        .page.active { display: block; }
        h2 { font-size: 2.25rem; margin-bottom: 10px; }
        .page-description { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 30px; }

        /* --- CARD & GRID STYLES --- */
        .card {
            background-color: var(--bg-white);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 24px;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }
        .kpi-card h3 { font-size: 1rem; color: var(--text-muted); font-weight: 500; }
        .kpi-card .metric-value { font-size: 2.25rem; font-weight: 700; color: var(--accent-blue); }
        
        /* --- TABLE STYLES --- */
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        thead th { padding: 12px 16px; text-align: left; font-weight: 600; color: var(--text-muted); border-bottom: 2px solid var(--border-color); }
        tbody td { padding: 16px; border-bottom: 1px solid var(--border-color); }
        tbody tr:last-child td { border-bottom: none; }
        tbody tr:hover { background-color: #f8f9fa; }
        
        /* --- INVESTMENT ANALYZER STYLES --- */
        .analyzer-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid var(--border-color); border-radius: 8px; }
        .form-button { width: 100%; padding: 15px; font-size: 1rem; font-weight: 600; color: #fff; background-color: var(--accent-blue); border: none; border-radius: 8px; cursor: pointer; }
        .scenario-card { background-color: var(--bg-light); padding: 20px; border-radius: 12px; margin-bottom: 16px; }
        .scenario-card h4 { display: flex; justify-content: space-between; }
        .scenario-card h4 span { background-color: var(--accent-blue); color: #fff; font-size: 0.8rem; padding: 4px 8px; border-radius: 10px; }

        /* --- LOADER --- */
        #loader { text-align: center; padding: 80px; }
        .loader-pulse { width: 50px; height: 50px; margin: auto; border-radius: 50%; background-color: var(--accent-blue); animation: pulse 1.5s infinite ease-in-out; }
        @keyframes pulse { 0% { transform: scale(0.8); opacity: 0.5; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(0.8); opacity: 0.5; } }

    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">Property <span>Dashboard</span></div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="#live-dashboard" class="nav-link active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Live Dashboard
            </a></li>
            <li class="nav-item"><a href="#investment-analyzer" class="nav-link">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
                Investment Analyzer
            </a></li>
             <li class="nav-item"><a href="#property-valuation" class="nav-link">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                Property Valuation
            </a></li>
        </ul>
    </aside>

    <main class="main-content">
        <section id="live-dashboard" class="page active">
            <h2>Live Market Dashboard</h2>
            <p class="page-description">Displaying the latest deals found by our daily automated scraper.</p>
            <div id="loader">
                <div class="loader-pulse"></div>
                <p style="margin-top: 20px; color: var(--text-muted);">Connecting to live market data...</p>
            </div>
            <div id="live-dashboard-content" class="card" style="display:none;">
                 <div class="table-wrapper">
                    <table id="results-table">
                        <thead><tr><th>Title</th><th>Price</th><th>Area (sqft)</th><th>Score</th></tr></thead>
                        <tbody id="results-body"></tbody>
                    </table>
                 </div>
            </div>
        </section>

        <section id="investment-analyzer" class="page">
            <h2>Investment Analyzer</h2>
            <p class="page-description">Calculate the potential return of any property by filling in the details below.</p>
            <div class="analyzer-layout card">
                <div>
                    <h3>Property Details</h3>
                    <div class="form-group"><label>Purchase Price</label><input type="number" id="ia-price" value="5000000"></div>
                    <div class="form-group"><label>Monthly Rent</label><input type="number" id="ia-rent" value="25000"></div>
                    <div class="form-group"><label>Interest Rate (%)</label><input type="number" id="ia-interest" value="7"></div>
                    <div class="form-group"><label>Down Payment</label><input type="number" id="ia-downpayment" value="1000000"></div>
                    <div class="form-group"><label>Monthly Expenses (Taxes, Insurance, etc.)</label><input type="number" id="ia-expenses" value="5000"></div>
                    <div class="form-group"><label>Loan Term (years)</label><input type="number" id="ia-term" value="30"></div>
                    <button id="ia-calculate-btn" class="form-button">Calculate Investment Metrics</button>
                </div>
                <div>
                    <h3>Investment Scenarios</h3>
                    <div class="scenario-card">
                        <h4>Cap Rate <span><span id="ia-cap-rate-result">--</span>%</span></h4>
                        <p class="page-description">The rate of return based on the income the property is expected to generate.</p>
                    </div>
                    <div class="scenario-card">
                        <h4>Cash-on-Cash Return <span><span id="ia-coc-result">--</span>%</span></h4>
                        <p class="page-description">The cash income earned on the cash you invested. This is a key profitability metric.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="property-valuation" class="page">
            <h2>AI Property Valuation</h2>
            <p class="page-description">Enter a property address to get a simulated AI-powered valuation and market analysis.</p>
            <div class="card">
                <h3>Property Address Search</h3>
                 <div class="form-group"><label>Property Address</label><input type="text" id="pv-address" placeholder="e.g., 123 Oak Street, Navi Mumbai"></div>
                 <button class="form-button">Analyze Property</button>
                 <div style="text-align:center; padding: 40px; color: var(--text-muted);">
                     <h3>Enter an address to begin.</h3>
                     <p>(This is a prototype feature for future development)</p>
                 </div>
            </div>
        </section>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- PAGE ROUTING LOGIC ---
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');

            function switchPage(hash) {
                navLinks.forEach(link => link.classList.remove('active'));
                pages.forEach(page => page.classList.remove('active'));

                const activeLink = document.querySelector(`.nav-link[href="${hash}"]`);
                const activePage = document.querySelector(hash);

                if (activeLink) activeLink.classList.add('active');
                if (activePage) activePage.classList.add('active');
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const hash = this.getAttribute('href');
                    switchPage(hash);
                    window.location.hash = hash;
                });
            });
            // Handle initial page load
            switchPage(window.location.hash || "#live-dashboard");


            // --- LIVE DASHBOARD LOGIC ---
            const apiBaseUrl = 'https://deal-hunter-api.onrender.com';
            const loader = document.getElementById('loader');
            
            fetch(`${apiBaseUrl}/results`)
                .then(response => response.json())
                .then(data => {
                    if (data.properties && data.properties.length > 0) {
                        loader.style.display = 'none';
                        document.getElementById('live-dashboard-content').style.display = 'block';
                        
                        const tableBody = document.getElementById('results-body');
                        tableBody.innerHTML = '';
                        data.properties.forEach(prop => {
                            let row = tableBody.insertRow();
                            row.innerHTML = `
                                <td>${prop.title}</td>
                                <td>${prop.price_text}</td>
                                <td>${prop.area_sqft}</td>
                                <td><b style="color: var(--accent-green)">${prop.investment_score.toFixed(2)}</b></td>
                            `;
                        });
                    } else {
                        loader.innerHTML = '<p>The database is empty. The daily automated scraper will populate it soon.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    loader.innerHTML = '<p>Failed to load data from the API. The server may be starting up.</p>';
                });

            // --- INVESTMENT ANALYZER LOGIC ---
            const calculateBtn = document.getElementById('ia-calculate-btn');
            calculateBtn.addEventListener('click', function() {
                const price = parseFloat(document.getElementById('ia-price').value);
                const rent = parseFloat(document.getElementById('ia-rent').value);
                const expenses = parseFloat(document.getElementById('ia-expenses').value);
                const downPayment = parseFloat(document.getElementById('ia-downpayment').value);
                const interest = parseFloat(document.getElementById('ia-interest').value) / 100;
                const term = parseFloat(document.getElementById('ia-term').value);

                // Calculate NOI
                const grossIncome = rent * 12;
                const opEx = expenses * 12;
                const noi = grossIncome - opEx;

                // Calculate Cap Rate
                const capRate = (noi / price) * 100;

                // Calculate Cash Flow
                const loanAmount = price - downPayment;
                const monthlyInterest = interest / 12;
                const numPayments = term * 12;
                const monthlyPayment = loanAmount * (monthlyInterest * Math.pow(1 + monthlyInterest, numPayments)) / (Math.pow(1 + monthlyInterest, numPayments) - 1);
                const annualDebtService = monthlyPayment * 12;
                const preTaxCashFlow = noi - annualDebtService;

                // Calculate Cash-on-Cash Return
                const cocReturn = (preTaxCashFlow / downPayment) * 100;

                // Display results
                document.getElementById('ia-cap-rate-result').innerText = capRate.toFixed(2);
                document.getElementById('ia-coc-result').innerText = cocReturn.toFixed(2);
            });
        });
    </script>
</body>
</html>
